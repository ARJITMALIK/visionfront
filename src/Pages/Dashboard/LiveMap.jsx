import React, { useEffect, useRef, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';

// Mock data representing survey coordinates for different political parties across Assam districts
const mockSurveyData = {
  'BJP': [
    '26.1445, 91.7362', '26.1523, 91.7445', '26.1389, 91.7289', '26.1567, 91.7523', '26.1412, 91.7401',
    '26.1498, 91.7334', '26.1556, 91.7478', '26.1434, 91.7367', '26.1501, 91.7412', '26.1478, 91.7389',
    '26.1512, 91.7456', '26.1423, 91.7378', '26.1489, 91.7423', '26.1534, 91.7467', '26.1456, 91.7390',
    '26.1487, 91.7401', '26.1523, 91.7434', '26.1467, 91.7389', '26.1534, 91.7456', '26.1489, 91.7412',
    '26.1512, 91.7445', '26.1478, 91.7378', '26.1501, 91.7423', '26.1545, 91.7467', '26.1467, 91.7401',
    '26.1850, 91.7514', '26.1823, 91.7489', '26.1867, 91.7534', '26.1834, 91.7501', '26.1856, 91.7523',
    '26.1845, 91.7512', '26.1878, 91.7545', '26.1823, 91.7478', '26.1856, 91.7534', '26.1834, 91.7489',
    '26.1867, 91.7523', '26.1845, 91.7501', '26.1878, 91.7534', '26.1823, 91.7512', '26.1856, 91.7489',
    '26.1158, 91.7086', '26.1134, 91.7067', '26.1178, 91.7112', '26.1145, 91.7089', '26.1167, 91.7098',
    '26.1156, 91.7078', '26.1189, 91.7123', '26.1134, 91.7056', '26.1167, 91.7089', '26.1145, 91.7067',
    '26.1287, 91.6589', '26.1267, 91.6567', '26.1312, 91.6612', '26.1278, 91.6589', '26.1298, 91.6601',
    '26.1289, 91.6578', '26.1323, 91.6623', '26.1267, 91.6556', '26.1298, 91.6589', '26.1278, 91.6567',
    '26.1923, 91.7697', '26.1912, 91.7678', '26.1945, 91.7723', '26.1934, 91.7689', '26.1956, 91.7712',
    '26.1923, 91.7689', '26.1967, 91.7734', '26.1912, 91.7667', '26.1945, 91.7689', '26.1934, 91.7678',
    '26.1234, 91.5678', '26.1256, 91.5701', '26.1212, 91.5645', '26.1245, 91.5689', '26.1267, 91.5712',
    '26.1223, 91.5656', '26.1278, 91.5723', '26.1201, 91.5634', '26.1256, 91.5689', '26.1234, 91.5667',
    '26.2345, 91.8234', '26.2367, 91.8256', '26.2323, 91.8212', '26.2356, 91.8245', '26.2378, 91.8267',
    '26.2334, 91.8223', '26.2389, 91.8278', '26.2312, 91.8201', '26.2367, 91.8245', '26.2345, 91.8223',
    '26.3484, 92.6931', '26.3467, 92.6912', '26.3512, 92.6956', '26.3478, 92.6923', '26.3498, 92.6945',
    '26.3489, 92.6934', '26.3523, 92.6967', '26.3456, 92.6901', '26.3498, 92.6923', '26.3478, 92.6912',
    '26.3256, 92.7145', '26.3278, 92.7167', '26.3234, 92.7123', '26.3267, 92.7156', '26.3289, 92.7178',
    '26.3245, 92.7134', '26.3301, 92.7189', '26.3223, 92.7112', '26.3278, 92.7156', '26.3256, 92.7134',
    '26.3678, 92.6723', '26.3689, 92.6734', '26.3656, 92.6712', '26.3667, 92.6734', '26.3701, 92.6745',
    '26.3645, 92.6701', '26.3712, 92.6756', '26.3634, 92.6690', '26.3689, 92.6734', '26.3667, 92.6712',
    '26.2006, 92.9376', '26.2023, 92.9389', '26.1989, 92.9363', '26.2012, 92.9378', '26.2034, 92.9401',
    '26.1978, 92.9352', '26.2045, 92.9412', '26.1967, 92.9341', '26.2023, 92.9378', '26.2006, 92.9363',
    '26.2456, 92.9142', '26.2467, 92.9156', '26.2445, 92.9128', '26.2478, 92.9167', '26.2489, 92.9178',
    '26.2434, 92.9117', '26.2501, 92.9189', '26.2423, 92.9106', '26.2467, 92.9156', '26.2456, 92.9128',
    '26.1678, 91.7489', '26.1689, 91.7501', '26.1667, 91.7478', '26.1701, 91.7512', '26.1656, 91.7467',
    '26.1712, 91.7523', '26.1645, 91.7456', '26.1689, 91.7501', '26.1678, 91.7489', '26.1701, 91.7512',
    '26.0789, 91.7234', '26.0801, 91.7245', '26.0778, 91.7223', '26.0812, 91.7256', '26.0767, 91.7212',
    '26.0823, 91.7267', '26.0756, 91.7201', '26.0801, 91.7245', '26.0789, 91.7234', '26.0812, 91.7256',
    '26.1345, 91.6789', '26.1356, 91.6801', '26.1334, 91.6778', '26.1367, 91.6812', '26.1323, 91.6767',
    '26.1378, 91.6823', '26.1312, 91.6756', '26.1356, 91.6801', '26.1345, 91.6789', '26.1367, 91.6812',
    '26.2123, 91.7845', '26.2134, 91.7856', '26.2112, 91.7834', '26.2145, 91.7867', '26.2101, 91.7823',
    '26.2156, 91.7878', '26.2090, 91.7812', '26.2134, 91.7856', '26.2123, 91.7845', '26.2145, 91.7867',
    '26.1567, 91.8123', '26.1578, 91.8134', '26.1556, 91.8112', '26.1589, 91.8145', '26.1545, 91.8101',
    '26.1601, 91.8156', '26.1534, 91.8090', '26.1578, 91.8134', '26.1567, 91.8123', '26.1589, 91.8145',
    '26.0956, 91.6234', '26.0967, 91.6245', '26.0945, 91.6223', '26.0978, 91.6256', '26.0934, 91.6212',
    '26.0989, 91.6267', '26.0923, 91.6201', '26.0967, 91.6245', '26.0956, 91.6234', '26.0978, 91.6256',
    '26.3123, 92.6456', '26.3134, 92.6467', '26.3112, 92.6445', '26.3145, 92.6478', '26.3101, 92.6434',
    '26.3156, 92.6489', '26.3090, 92.6423', '26.3134, 92.6467', '26.3123, 92.6456', '26.3145, 92.6478',
    '26.3345, 92.7234', '26.3356, 92.7245', '26.3334, 92.7223', '26.3367, 92.7256', '26.3323, 92.7212',
    '26.3378, 92.7267', '26.3312, 92.7201', '26.3356, 92.7245', '26.3345, 92.7234', '26.3367, 92.7256',
    '26.3567, 92.7045', '26.3578, 92.7056', '26.3556, 92.7034', '26.3589, 92.7067', '26.3545, 92.7023',
    '26.3601, 92.7078', '26.3534, 92.7012', '26.3578, 92.7056', '26.3567, 92.7045', '26.3589, 92.7067',
    '26.2234, 92.8789', '26.2245, 92.8801', '26.2223, 92.8778', '26.2256, 92.8812', '26.2212, 92.8767',
    '26.2267, 92.8823', '26.2201, 92.8756', '26.2245, 92.8801', '26.2234, 92.8789', '26.2256, 92.8812',
    '26.2567, 92.9345', '26.2578, 92.9356', '26.2556, 92.9334', '26.2589, 92.9367', '26.2545, 92.9323',
    '26.2601, 92.9378', '26.2534, 92.9312', '26.2578, 92.9356', '26.2567, 92.9345', '26.2589, 92.9367',
    '26.1789, 91.7678', '26.1801, 91.7689', '26.1778, 91.7667', '26.1812, 91.7701', '26.1767, 91.7656',
    '26.1823, 91.7712', '26.1756, 91.7645', '26.1801, 91.7689', '26.1789, 91.7678', '26.1812, 91.7701',
    '26.1456, 91.7234', '26.1467, 91.7245', '26.1445, 91.7223', '26.1478, 91.7256', '26.1434, 91.7212',
    '26.1489, 91.7267', '26.1423, 91.7201', '26.1467, 91.7245', '26.1456, 91.7234', '26.1478, 91.7256',
    '26.2089, 91.7456', '26.2101, 91.7467', '26.2078, 91.7445', '26.2112, 91.7478', '26.2067, 91.7434'
  ],
  'INC': [
    '26.0050, 94.6189', '26.0067, 94.6201', '26.0034, 94.6178', '26.0078, 94.6212', '26.0023, 94.6167',
    '26.0089, 94.6223', '26.0012, 94.6156', '26.0067, 94.6201', '26.0050, 94.6189', '26.0078, 94.6212',
    '26.0234, 94.6453', '26.0245, 94.6467', '26.0223, 94.6439', '26.0256, 94.6478', '26.0212, 94.6428',
    '26.0267, 94.6489', '26.0201, 94.6417', '26.0245, 94.6467', '26.0234, 94.6453', '26.0256, 94.6478',
    '26.9847, 94.6145', '25.9856, 94.6156', '25.9834, 94.6134', '25.9867, 94.6167', '25.9823, 94.6123',
    '25.9878, 94.6178', '25.9812, 94.6112', '25.9856, 94.6156', '25.9847, 94.6145', '25.9867, 94.6167',
    '26.7509, 94.2037', '26.7523, 94.2048', '26.7495, 94.2026', '26.7534, 94.2059', '26.7484, 94.2015',
    '26.7545, 94.2070', '26.7473, 94.2004', '26.7523, 94.2048', '26.7509, 94.2037', '26.7534, 94.2059',
    '26.7312, 94.1876', '26.7323, 94.1887', '26.7301, 94.1865', '26.7334, 94.1898', '26.7290, 94.1854',
    '26.7345, 94.1909', '26.7279, 94.1843', '26.7323, 94.1887', '26.7312, 94.1876', '26.7334, 94.1898',
    '26.7689, 94.2234', '26.7701, 94.2245', '26.7678, 94.2223', '26.7712, 94.2256', '26.7667, 94.2212',
    '26.7723, 94.2267', '26.7656, 94.2201', '26.7701, 94.2245', '26.7689, 94.2234', '26.7712, 94.2256',
    '26.0123, 94.6345', '26.0134, 94.6356', '26.0112, 94.6334', '26.0145, 94.6367', '26.0101, 94.6323',
    '26.0156, 94.6378', '26.0090, 94.6312', '26.0134, 94.6356', '26.0123, 94.6345', '26.0145, 94.6367',
    '26.7456, 94.1923', '26.7467, 94.1934', '26.7445, 94.1912', '26.7478, 94.1945', '26.7434, 94.1901',
    '26.7489, 94.1956', '26.7423, 94.1890', '26.7467, 94.1934', '26.7456, 94.1923', '26.7478, 94.1945',
    '26.7634, 94.2123', '26.7645, 94.2134', '26.7623, 94.2112', '26.7656, 94.2145', '26.7612, 94.2101',
    '26.7667, 94.2156', '26.7601, 94.2090', '26.7645, 94.2134', '26.7634, 94.2123', '26.7656, 94.2145',
    '26.0189, 94.6278', '26.0201, 94.6289', '26.0178, 94.6267', '26.0212, 94.6301', '26.0167, 94.6256',
    '26.0223, 94.6312', '26.0156, 94.6245', '26.0201, 94.6289', '26.0189, 94.6278', '26.0212, 94.6301',
    '26.7578, 94.2089', '26.7589, 94.2101', '26.7567, 94.2078', '26.7601, 94.2112', '26.7556, 94.2067',
    '26.7612, 94.2123', '26.7545, 94.2056', '26.7589, 94.2101', '26.7578, 94.2089', '26.7601, 94.2112',
    '25.9978, 94.6112', '25.9989, 94.6123', '25.9967, 94.6101', '26.0001, 94.6134', '25.9956, 94.6090',
    '26.0012, 94.6145', '25.9945, 94.6079', '25.9989, 94.6123', '25.9978, 94.6112', '26.0001, 94.6134',
    '26.7423, 94.1789', '26.7434, 94.1801', '26.7412, 94.1778', '26.7445, 94.1812', '26.7401, 94.1767',
    '26.7456, 94.1823', '26.7390, 94.1756', '26.7434, 94.1801', '26.7423, 94.1789', '26.7445, 94.1812',
    '26.7745, 94.2189', '26.7756, 94.2201', '26.7734, 94.2178', '26.7767, 94.2212', '26.7723, 94.2167',
    '26.7778, 94.2223', '26.7712, 94.2156', '26.7756, 94.2201', '26.7745, 94.2189', '26.7767, 94.2212',
    '26.0256, 94.6389', '26.0267, 94.6401', '26.0245, 94.6378', '26.0278, 94.6412', '26.0234, 94.6367',
    '26.0289, 94.6423', '26.0223, 94.6356', '26.0267, 94.6401', '26.0256, 94.6389', '26.0278, 94.6412',
    '26.7812, 94.2156', '26.7823, 94.2167', '26.7801, 94.2145', '26.7834, 94.2178', '26.7790, 94.2134',
    '26.7845, 94.2189', '26.7779, 94.2123', '26.7823, 94.2167', '26.7812, 94.2156', '26.7834, 94.2178',
    '26.0312, 94.6467', '26.0323, 94.6478', '26.0301, 94.6456', '26.0334, 94.6489', '26.0290, 94.6445',
    '26.0345, 94.6501', '26.0279, 94.6434', '26.0323, 94.6478', '26.0312, 94.6467', '26.0334, 94.6489',
    '26.7389, 94.1956', '26.7401, 94.1967', '26.7378, 94.1945', '26.7412, 94.1978', '26.7367, 94.1934',
    '26.7423, 94.1989', '26.7356, 94.1923', '26.7401, 94.1967', '26.7389, 94.1956', '26.7412, 94.1978',
    '26.7556, 94.2012', '26.7567, 94.2023', '26.7545, 94.2001', '26.7578, 94.2034', '26.7534, 94.1990',
    '26.7589, 94.2045', '26.7523, 94.1979', '26.7567, 94.2023', '26.7556, 94.2012', '26.7578, 94.2034',
    '26.0145, 94.6234', '26.0156, 94.6245', '26.0134, 94.6223', '26.0167, 94.6256', '26.0123, 94.6212',
    '26.0178, 94.6267', '26.0112, 94.6201', '26.0156, 94.6245', '26.0145, 94.6234', '26.0167, 94.6256',
    '26.7489, 94.1867', '26.7501, 94.1878', '26.7478, 94.1856', '26.7512, 94.1889', '26.7467, 94.1845'
  ],
  'AGP': [
    '26.3484, 92.6931', '26.3495, 92.6942', '26.3473, 92.6920', '26.3506, 92.6953', '26.3462, 92.6909',
    '26.3517, 92.6964', '26.3451, 92.6898', '26.3495, 92.6942', '26.3484, 92.6931', '26.3506, 92.6953',
    '26.3256, 92.7145', '26.3267, 92.7156', '26.3245, 92.7134', '26.3278, 92.7167', '26.3234, 92.7123',
    '26.3289, 92.7178', '26.3223, 92.7112', '26.3267, 92.7156', '26.3256, 92.7145', '26.3278, 92.7167',
    '26.3678, 92.6723', '26.3689, 92.6734', '26.3667, 92.6712', '26.3701, 92.6745', '26.3656, 92.6701',
    '26.3712, 92.6756', '26.3645, 92.6690', '26.3689, 92.6734', '26.3678, 92.6723', '26.3701, 92.6745',
    '26.2006, 92.9376', '26.2017, 92.9387', '26.1995, 92.9365', '26.2028, 92.9398', '26.1984, 92.9354',
    '26.2039, 92.9409', '26.1973, 92.9343', '26.2017, 92.9387', '26.2006, 92.9376', '26.2028, 92.9398',
    '26.1834, 92.9512', '26.1845, 92.9523', '26.1823, 92.9501', '26.1856, 92.9534', '26.1812, 92.9490',
    '26.1867, 92.9545', '26.1801, 92.9479', '26.1845, 92.9523', '26.1834, 92.9512', '26.1856, 92.9534',
    '26.3412, 92.6845', '26.3423, 92.6856', '26.3401, 92.6834', '26.3434, 92.6867', '26.3390, 92.6823',
    '26.3445, 92.6878', '26.3379, 92.6812', '26.3423, 92.6856', '26.3412, 92.6845', '26.3434, 92.6867',
    '26.3589, 92.6889', '26.3601, 92.6901', '26.3578, 92.6878', '26.3612, 92.6912', '26.3567, 92.6867',
    '26.3623, 92.6923', '26.3556, 92.6856', '26.3601, 92.6901', '26.3589, 92.6889', '26.3612, 92.6912',
    '26.3312, 92.7234', '26.3323, 92.7245', '26.3301, 92.7223', '26.3334, 92.7256', '26.3290, 92.7212',
    '26.3345, 92.7267', '26.3279, 92.7201', '26.3323, 92.7245', '26.3312, 92.7234', '26.3334, 92.7256',
    '26.2123, 92.9289', '26.2134, 92.9301', '26.2112, 92.9278', '26.2145, 92.9312', '26.2101, 92.9267',
    '26.2156, 92.9323', '26.2090, 92.9256', '26.2134, 92.9301', '26.2123, 92.9289', '26.2145, 92.9312',
    '26.1945, 92.9423', '26.1956, 92.9434', '26.1934, 92.9412', '26.1967, 92.9445', '26.1923, 92.9401',
    '26.1978, 92.9456', '26.1912, 92.9390', '26.1956, 92.9434', '26.1945, 92.9423', '26.1967, 92.9445',
    '26.3523, 92.6978', '26.3534, 92.6989', '26.3512, 92.6967', '26.3545, 92.7001', '26.3501, 92.6956',
    '26.3556, 92.7012', '26.3490, 92.6945', '26.3534, 92.6989', '26.3523, 92.6978', '26.3545, 92.7001',
    '26.3189, 92.7089', '26.3201, 92.7101', '26.3178, 92.7078', '26.3212, 92.7112', '26.3167, 92.7067',
    '26.3223, 92.7123', '26.3156, 92.7056', '26.3201, 92.7101', '26.3189, 92.7089', '26.3212, 92.7112',
    '26.3734, 92.6812', '26.3745, 92.6823', '26.3723, 92.6801', '26.3756, 92.6834', '26.3712, 92.6790',
    '26.3767, 92.6845', '26.3701, 92.6779', '26.3745, 92.6823', '26.3734, 92.6812', '26.3756, 92.6834',
    '26.2067, 92.9301', '26.2078, 92.9312', '26.2056, 92.9290', '26.2089, 92.9323', '26.2045, 92.9279',
    '26.2101, 92.9334', '26.2034, 92.9268', '26.2078, 92.9312', '26.2067, 92.9301', '26.2089, 92.9323',
    '26.1789, 92.9456', '26.1801, 92.9467', '26.1778, 92.9445', '26.1812, 92.9478', '26.1767, 92.9434',
    '26.1823, 92.9489', '26.1756, 92.9423', '26.1801, 92.9467', '26.1789, 92.9456', '26.1812, 92.9478',
    '26.3445, 92.6756', '26.3456, 92.6767', '26.3434, 92.6745', '26.3467, 92.6778', '26.3423, 92.6734',
    '26.3478, 92.6789', '26.3412, 92.6723', '26.3456, 92.6767', '26.3445, 92.6756', '26.3467, 92.6778',
    '26.3623, 92.6645', '26.3634, 92.6656', '26.3612, 92.6634', '26.3645, 92.6667', '26.3601, 92.6623'
  ],
  'CPI(M)': [
    '26.7509, 94.2037', '26.7520, 94.2048', '26.7498, 94.2026', '26.7531, 94.2059', '26.7487, 94.2015',
    '26.7542, 94.2070', '26.7476, 94.2004', '26.7520, 94.2048', '26.7509, 94.2037', '26.7531, 94.2059',
    '26.7745, 94.2189', '26.7756, 94.2200', '26.7734, 94.2178', '26.7767, 94.2211', '26.7723, 94.2167',
    '26.7778, 94.2222', '26.7712, 94.2156', '26.7756, 94.2200', '26.7745, 94.2189', '26.7767, 94.2211',
    '26.0050, 94.6189', '26.0061, 94.6200', '26.0039, 94.6178', '26.0072, 94.6211', '26.0028, 94.6167',
    '26.0083, 94.6222', '26.0017, 94.6156', '26.0061, 94.6200', '26.0050, 94.6189', '26.0072, 94.6211',
    '26.0167, 94.6345', '26.0178, 94.6356', '26.0156, 94.6334', '26.0189, 94.6367', '26.0145, 94.6323',
    '26.0200, 94.6378', '26.0134, 94.6312', '26.0178, 94.6356', '26.0167, 94.6345', '26.0189, 94.6367',
    '26.7623, 94.2112', '26.7634, 94.2123', '26.7612, 94.2101', '26.7645, 94.2134', '26.7601, 94.2090',
    '26.7656, 94.2145', '26.7590, 94.2079', '26.7634, 94.2123', '26.7623, 94.2112', '26.7645, 94.2134',
    '26.7456, 94.2156', '26.7467, 94.2167', '26.7445, 94.2145', '26.7478, 94.2178', '26.7434, 94.2134',
    '26.7489, 94.2189', '26.7423, 94.2123', '26.7467, 94.2167', '26.7456, 94.2156', '26.7478, 94.2178',
    '26.0089, 94.6278', '26.0100, 94.6289', '26.0078, 94.6267', '26.0111, 94.6300', '26.0067, 94.6256',
    '26.0122, 94.6311', '26.0056, 94.6245', '26.0100, 94.6289', '26.0089, 94.6278', '26.0111, 94.6300',
    '26.7801, 94.2234', '26.7812, 94.2245', '26.7790, 94.2223', '26.7823, 94.2256', '26.7779, 94.2212',
    '26.7834, 94.2267', '26.7768, 94.2201', '26.7812, 94.2245', '26.7801, 94.2234', '26.7823, 94.2256',
    '26.0223, 94.6423', '26.0234, 94.6434', '26.0212, 94.6412', '26.0245, 94.6445', '26.0201, 94.6401',
    '26.0256, 94.6456', '26.0190, 94.6390', '26.0234, 94.6434', '26.0223, 94.6423', '26.0245, 94.6445',
    '26.7567, 94.2089', '26.7578, 94.2100', '26.7556, 94.2078', '26.7589, 94.2111', '26.7545, 94.2067',
    '26.7600, 94.2122', '26.7534, 94.2056', '26.7578, 94.2100', '26.7567, 94.2089', '26.7589, 94.2111',
    '26.7689, 94.2267', '26.7700, 94.2278', '26.7678, 94.2256', '26.7711, 94.2289', '26.7667, 94.2245',
    '26.7722, 94.2300', '26.7656, 94.2234', '26.7700, 94.2278', '26.7689, 94.2267', '26.7711, 94.2289',
    '26.0134, 94.6512', '26.0145, 94.6523', '26.0123, 94.6501', '26.0156, 94.6534', '26.0112, 94.6490',
    '26.0167, 94.6545', '26.0101, 94.6479', '26.0145, 94.6523', '26.0134, 94.6512', '26.0156, 94.6534',
    '26.7412, 94.2023', '26.7423, 94.2034', '26.7401, 94.2012', '26.7434, 94.2045', '26.7390, 94.2001',
    '26.7445, 94.2056', '26.7379, 94.1990', '26.7423, 94.2034', '26.7412, 94.2023', '26.7434, 94.2045'
  ],
  'BPF': [
    '26.4547, 90.3564', '26.4558, 90.3575', '26.4536, 90.3553', '26.4569, 90.3586', '26.4525, 90.3542',
    '26.4580, 90.3597', '26.4514, 90.3531', '26.4558, 90.3575', '26.4547, 90.3564', '26.4569, 90.3586',
    '26.4389, 90.3712', '26.4400, 90.3723', '26.4378, 90.3701', '26.4411, 90.3734', '26.4367, 90.3690',
    '26.4422, 90.3745', '26.4356, 90.3679', '26.4400, 90.3723', '26.4389, 90.3712', '26.4411, 90.3734',
    '26.4712, 90.3423', '26.4723, 90.3434', '26.4701, 90.3412', '26.4734, 90.3445', '26.4690, 90.3401',
    '26.4745, 90.3456', '26.4679, 90.3390', '26.4723, 90.3434', '26.4712, 90.3423', '26.4734, 90.3445',
    '26.6417, 90.6389', '26.6428, 90.6400', '26.6406, 90.6378', '26.6439, 90.6411', '26.6395, 90.6367',
    '26.6450, 90.6422', '26.6384, 90.6356', '26.6428, 90.6400', '26.6417, 90.6389', '26.6439, 90.6411',
    '26.4623, 90.3589', '26.4634, 90.3600', '26.4612, 90.3578', '26.4645, 90.3611', '26.4601, 90.3567',
    '26.4656, 90.3622', '26.4590, 90.3556', '26.4634, 90.3600', '26.4623, 90.3589', '26.4645, 90.3611',
    '26.4478, 90.3645', '26.4489, 90.3656', '26.4467, 90.3634', '26.4500, 90.3667', '26.4456, 90.3623',
    '26.4511, 90.3678', '26.4445, 90.3612', '26.4489, 90.3656', '26.4478, 90.3645', '26.4500, 90.3667',
    '26.6512, 90.6456', '26.6523, 90.6467', '26.6501, 90.6445', '26.6534, 90.6478', '26.6490, 90.6434',
    '26.6545, 90.6489', '26.6479, 90.6423', '26.6523, 90.6467', '26.6512, 90.6456', '26.6534, 90.6478',
    '26.4801, 90.3512', '26.4812, 90.3523', '26.4790, 90.3501', '26.4823, 90.3534', '26.4779, 90.3490',
    '26.4834, 90.3545', '26.4768, 90.3479', '26.4812, 90.3523', '26.4801, 90.3512', '26.4823, 90.3534',
    '26.6334, 90.6278', '26.6345, 90.6289', '26.6323, 90.6267', '26.6356, 90.6300', '26.6312, 90.6256',
    '26.6367, 90.6311', '26.6301, 90.6245', '26.6345, 90.6289', '26.6334, 90.6278', '26.6356, 90.6300'
  ],
  'UPPL': [
    '26.4547, 90.3564', '26.4559, 90.3576', '26.4535, 90.3552', '26.4571, 90.3588', '26.4523, 90.3540',
    '26.4583, 90.3600', '26.4511, 90.3528', '26.4559, 90.3576', '26.4547, 90.3564', '26.4571, 90.3588',
    '26.4612, 90.3689', '26.4623, 90.3700', '26.4601, 90.3678', '26.4634, 90.3711', '26.4590, 90.3667',
    '26.4645, 90.3722', '26.4579, 90.3656', '26.4623, 90.3700', '26.4612, 90.3689', '26.4634, 90.3711',
    '26.5436, 89.8622', '26.5447, 89.8633', '26.5425, 89.8611', '26.5458, 89.8644', '26.5414, 89.8600',
    '26.5469, 89.8655', '26.5403, 89.8589', '26.5447, 89.8633', '26.5436, 89.8622', '26.5458, 89.8644',
    '26.4723, 90.3734', '26.4734, 90.3745', '26.4712, 90.3723', '26.4745, 90.3756', '26.4701, 90.3712',
    '26.4756, 90.3767', '26.4690, 90.3701', '26.4734, 90.3745', '26.4723, 90.3734', '26.4745, 90.3756',
    '26.5523, 89.8734', '26.5534, 89.8745', '26.5512, 89.8723', '26.5545, 89.8756', '26.5501, 89.8712',
    '26.5556, 89.8767', '26.5490, 89.8701', '26.5534, 89.8745', '26.5523, 89.8734', '26.5545, 89.8756',
    '26.4834, 90.3612', '26.4845, 90.3623', '26.4823, 90.3601', '26.4856, 90.3634', '26.4812, 90.3590',
    '26.4867, 90.3645', '26.4801, 90.3579', '26.4845, 90.3623', '26.4834, 90.3612', '26.4856, 90.3634',
    '26.5612, 89.8845', '26.5623, 89.8856', '26.5601, 89.8834', '26.5634, 89.8867', '26.5590, 89.8823',
    '26.5645, 89.8878', '26.5579, 89.8812', '26.5623, 89.8856', '26.5612, 89.8845', '26.5634, 89.8867'
  ],
  'OTH': [
    '26.1445, 91.7362', '26.1457, 91.7374', '26.1433, 91.7350', '26.1469, 91.7386', '26.1421, 91.7338',
    '26.1481, 91.7398', '26.1409, 91.7326', '26.1457, 91.7374', '26.1445, 91.7362', '26.1469, 91.7386',
    '26.1678, 91.7489', '26.1689, 91.7500', '26.1667, 91.7478', '26.1700, 91.7511', '26.1656, 91.7467',
    '26.1711, 91.7522', '26.1645, 91.7456', '26.1689, 91.7500', '26.1678, 91.7489', '26.1700, 91.7511',
    '26.3484, 92.6931', '26.3495, 92.6942', '26.3473, 92.6920', '26.3506, 92.6953', '26.3462, 92.6909',
    '26.3517, 92.6964', '26.3451, 92.6898', '26.3495, 92.6942', '26.3484, 92.6931', '26.3506, 92.6953',
    '26.3567, 92.7045', '26.3578, 92.7056', '26.3556, 92.7034', '26.3589, 92.7067', '26.3545, 92.7023',
    '26.3600, 92.7078', '26.3534, 92.7012', '26.3578, 92.7056', '26.3567, 92.7045', '26.3589, 92.7067',
    '26.7509, 94.2037', '26.7520, 94.2048', '26.7498, 94.2026', '26.7531, 94.2059', '26.7487, 94.2015',
    '26.7542, 94.2070', '26.7476, 94.2004', '26.7520, 94.2048', '26.7509, 94.2037', '26.7531, 94.2059',
    '26.1789, 91.7623', '26.1800, 91.7634', '26.1778, 91.7612', '26.1811, 91.7645', '26.1767, 91.7601',
    '26.1822, 91.7656', '26.1756, 91.7590', '26.1800, 91.7634', '26.1789, 91.7623', '26.1811, 91.7645',
    '26.2234, 91.7845', '26.2245, 91.7856', '26.2223, 91.7834', '26.2256, 91.7867', '26.2212, 91.7823',
    '26.2267, 91.7878', '26.2201, 91.7812', '26.2245, 91.7856', '26.2234, 91.7845', '26.2256, 91.7867',
    '26.3412, 92.6823', '26.3423, 92.6834', '26.3401, 92.6812', '26.3434, 92.6845', '26.3390, 92.6801',
    '26.3445, 92.6856', '26.3379, 92.6790', '26.3423, 92.6834', '26.3412, 92.6823', '26.3434, 92.6845',
    '26.3645, 92.7123', '26.3656, 92.7134', '26.3634, 92.7112', '26.3667, 92.7145', '26.3623, 92.7101',
    '26.3678, 92.7156', '26.3612, 92.7090', '26.3656, 92.7134', '26.3645, 92.7123', '26.3667, 92.7145',
    '26.0912, 91.6734', '26.0923, 91.6745', '26.0901, 91.6723', '26.0934, 91.6756', '26.0890, 91.6712',
    '26.0945, 91.6767', '26.0879, 91.6701', '26.0923, 91.6745', '26.0912, 91.6734', '26.0934, 91.6756',
    '26.2456, 91.8123', '26.2467, 91.8134', '26.2445, 91.8112', '26.2478, 91.8145', '26.2434, 91.8101',
    '26.2489, 91.8156', '26.2423, 91.8090', '26.2467, 91.8134', '26.2456, 91.8123', '26.2478, 91.8145',
    '26.3734, 92.6912', '26.3745, 92.6923', '26.3723, 92.6901', '26.3756, 92.6934', '26.3712, 92.6890',
    '26.3767, 92.6945', '26.3701, 92.6879', '26.3745, 92.6923', '26.3734, 92.6912', '26.3756, 92.6934',
    '26.1567, 91.7612', '26.1578, 91.7623', '26.1556, 91.7601', '26.1589, 91.7634', '26.1545, 91.7590',
    '26.1600, 91.7645', '26.1534, 91.7579', '26.1578, 91.7623', '26.1567, 91.7612', '26.1589, 91.7634'
  ]
};

const LiveMap = () => {
  const mapRef = useRef(null);
  const [map, setMap] = useState(null);
  const [mapData, setMapData] = useState([]);
  const [isLoading, setIsLoading] = useState(true);

  // Process mock data into the format expected by the map
  const processData = () => {
    const processedData = [];
    let colIndex = 0;

    Object.entries(mockSurveyData).forEach(([partyName, coordinates]) => {
      const partyCoordinates = [];
      
      coordinates.forEach((coordString, rowIndex) => {
        const coordMatch = coordString.trim().match(/(-?\d+\.?\d*),\s*(-?\d+\.?\d*)/);
        if (coordMatch) {
          const lat = parseFloat(coordMatch[1]);
          const lng = parseFloat(coordMatch[2]);
          if (!isNaN(lat) && !isNaN(lng)) {
            partyCoordinates.push({ lat, lng, rowIndex: rowIndex + 1 });
          }
        }
      });

      if (partyCoordinates.length > 0) {
        processedData.push({
          party: partyName,
          coordinates: partyCoordinates,
          color: getPartyColor(partyName, colIndex)
        });
      }
      colIndex++;
    });

    return processedData;
  };

  const getPartyColor = (partyName, index) => {
    const colors = [
      '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
      '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',
      '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#D5A6BD'
    ];
    
    const partyColorMap = {
      'BJP': '#FF8C00',
      'INC': '#19AAED',
      'OTH': '#6B7280',
      'AGP': '#8B0000',
      'CPI(M)': '#DC2626',
      'BPF': '#1E40AF',
      'UPPL': '#EAB308'
    };
    
    return partyColorMap[partyName] || colors[index % colors.length];
  };

  const initializeMap = (data) => {
    // Load Leaflet dynamically
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js';
    script.onload = () => {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';
      document.head.appendChild(link);

      // Initialize map centered on Assam
      const leafletMap = window.L.map(mapRef.current).setView([26.2006, 92.9376], 8);

      // Add tile layer
      window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(leafletMap);

      const bounds = [];
      
      // Add individual survey points as colored dots
      data.forEach((partyData) => {
        const { party, coordinates, color } = partyData;
        
        coordinates.forEach((coord, index) => {
          bounds.push([coord.lat, coord.lng]);
          
          const marker = window.L.circleMarker([coord.lat, coord.lng], {
            color: '#ffffff',
            fillColor: color,
            fillOpacity: 0.8,
            radius: 6,
            stroke: true,
            weight: 2
          });

          // Create popup with details and Google Maps button
          const popupContent = `
            <div style="min-width: 200px;">
              <div style="margin-bottom: 8px;">
                <strong style="color: ${color}; font-size: 16px;">${party}</strong>
              </div>
              <div style="margin-bottom: 8px; font-size: 14px;">
                <strong>Survey Point #${index + 1}</strong>
              </div>
              <div style="margin-bottom: 8px; font-size: 13px; color: #666;">
                <strong>Coordinates:</strong><br>
                Latitude: ${coord.lat}<br>
                Longitude: ${coord.lng}
              </div>
              <button 
                onclick="window.open('https://www.google.com/maps?q=${coord.lat},${coord.lng}', '_blank')"
                style="
                  background-color: #4285f4;
                  color: white;
                  border: none;
                  padding: 8px 12px;
                  border-radius: 4px;
                  cursor: pointer;
                  font-size: 12px;
                  width: 100%;
                  margin-top: 5px;
                "
                onmouseover="this.style.backgroundColor='#3367d6'"
                onmouseout="this.style.backgroundColor='#4285f4'"
              >
                üìç Open in Google Maps
              </button>
            </div>
          `;

          marker.bindPopup(popupContent, {
            maxWidth: 250,
            className: 'custom-popup'
          });

          // Add hover effect
          marker.on('mouseover', function() {
            this.setStyle({
              radius: 8,
              fillOpacity: 1
            });
          });

          marker.on('mouseout', function() {
            this.setStyle({
              radius: 6,
              fillOpacity: 0.8
            });
          });

          marker.addTo(leafletMap);
        });
      });

      // Fit map to show all points
      if (bounds.length > 0) {
        leafletMap.fitBounds(bounds, { padding: [20, 20] });
      }

      setMap(leafletMap);
      setIsLoading(false);
    };

    document.head.appendChild(script);
  };

  useEffect(() => {
    const data = processData();
    setMapData(data);
    
    // Initialize map after component mounts
    setTimeout(() => {
      initializeMap(data);
    }, 100);

    // Cleanup
    return () => {
      if (map) {
        map.remove();
      }
    };
  }, []);

  // Calculate statistics
  const totalPoints = mapData.reduce((sum, item) => sum + item.coordinates.length, 0);

  return (
    <div className="p-6 max-w-7xl mx-auto space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="text-2xl font-bold">Political Survey Map Viewer</CardTitle>
          <p className="text-gray-600">Interactive map showing survey points across Assam by political party</p>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Legend */}
          <div>
            <h3 className="text-lg font-semibold mb-3">Party Distribution</h3>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
              {mapData.map((item) => {
                const percentage = totalPoints > 0 ? ((item.coordinates.length / totalPoints) * 100).toFixed(1) : 0;
                return (
                  <div key={item.party} className="flex items-center space-x-2">
                    <div 
                      className="w-4 h-4 rounded-full border-2 border-white shadow-sm"
                      style={{ backgroundColor: item.color }}
                    />
                    <span className="text-sm font-medium">{item.party}</span>
                    <Badge variant="secondary" className="text-xs">
                      {percentage}%
                    </Badge>
                  </div>
                );
              })}
            </div>
            <p className="text-xs text-gray-500 mt-3">
              * Click on any dot to see details and get directions ‚Ä¢ Total survey points: {totalPoints}
            </p>
          </div>

          {/* Map Container */}
          <Card>
            <CardContent className="p-4">
              <div className="relative">
                {isLoading && (
                  <div className="absolute inset-0 bg-gray-50 rounded-lg flex items-center justify-center z-10">
                    <div className="text-center">
                      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
                      <p className="text-gray-600 text-sm">Loading map...</p>
                    </div>
                  </div>
                )}
                <div 
                  ref={mapRef} 
                  className="w-full rounded-lg border-2 border-gray-200" 
                  style={{ height: '600px', minHeight: '400px' }}
                />
              </div>
            </CardContent>
          </Card>

          {/* Statistics */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <Card>
              <CardContent className="p-4 text-center">
                <div className="text-2xl font-bold text-blue-600">{mapData.length}</div>
                <div className="text-sm text-gray-600">Political Parties</div>
              </CardContent>
            </Card>
            <Card>
              <CardContent className="p-4 text-center">
                <div className="text-2xl font-bold text-green-600">{totalPoints}</div>
                <div className="text-sm text-gray-600">Survey Points</div>
              </CardContent>
            </Card>
            <Card>
              <CardContent className="p-4 text-center">
                <div className="text-2xl font-bold text-purple-600">
                  {mapData.length > 0 ? Math.round(totalPoints / mapData.length) : 0}
                </div>
                <div className="text-sm text-gray-600">Avg. Points/Party</div>
              </CardContent>
            </Card>
            <Card>
              <CardContent className="p-4 text-center">
                <div className="text-2xl font-bold text-orange-600">Assam</div>
                <div className="text-sm text-gray-600">Coverage Area</div>
              </CardContent>
            </Card>
          </div>
        </CardContent>
      </Card>

      <style jsx>{`
        .custom-popup .leaflet-popup-content-wrapper {
          border-radius: 8px;
        }
        .custom-popup .leaflet-popup-content {
          margin: 12px;
        }
      `}</style>
    </div>
  );
};

export default LiveMap;